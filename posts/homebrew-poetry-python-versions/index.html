<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Managing multiple python versions with Homebrew and Poetry | João G. Sousa</title>
<link rel=canonical href=//www.jgsousa.com/posts/homebrew-poetry-python-versions/><meta name=description content="I’m João. I enjoy computers, data, math."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Managing multiple python versions with Homebrew and Poetry"><meta property="og:description" content="tl;dr brew install python@<pythonversion> to install multiple python versions poetry env use <pythonversion> to create virtual environment direnv to automatically switch on entering directory I&rsquo;ve always felt a bit hesitant to try out new tools for managing my python development environments. I had been safe and happy in the antiquated but efficient pip + virtualenv + pyenv world, and had been burned before when I dared adventure beyond the path of the tried and true of old."><meta property="og:type" content="article"><meta property="og:url" content="//www.jgsousa.com/posts/homebrew-poetry-python-versions/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-14T14:56:06+00:00"><meta property="article:modified_time" content="2022-11-14T14:56:06+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Managing multiple python versions with Homebrew and Poetry"><meta name=twitter:description content="tl;dr brew install python@<pythonversion> to install multiple python versions poetry env use <pythonversion> to create virtual environment direnv to automatically switch on entering directory I&rsquo;ve always felt a bit hesitant to try out new tools for managing my python development environments. I had been safe and happy in the antiquated but efficient pip + virtualenv + pyenv world, and had been burned before when I dared adventure beyond the path of the tried and true of old."><link rel=stylesheet href=//www.jgsousa.com/css/styles.7c754dee4bfc873743b12288cf94eadcfd3bee1f2cff5a106753b8047879ac5195c8d8ad90f6d73f12e9c841696c51a0abdeae8394e3eb3079f310f418ddf9ec.css integrity="sha512-fHVN7kv8hzdDsSKIz5Tq3P077h8s/1oQZ1O4BHh5rFGVyNitkPbXPxLpyEFpbFGgq96ug5Tj6zB58xD0GN357A=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=//www.jgsousa.com/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=//www.jgsousa.com/404.html aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=//www.jgsousa.com/posts/go-forth-and-prosper/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&text=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&title=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&is_video=false&description=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry&body=Check out this article: %2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&title=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&title=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&name=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry&description=tl%3bdr%20brew%20install%20python%40%26lt%3bpythonversion%26gt%3b%20to%20install%20multiple%20python%20versions%20poetry%20env%20use%20%26lt%3bpythonversion%26gt%3b%20to%20create%20virtual%20environment%20direnv%20to%20automatically%20switch%20on%20entering%20directory%20I%26rsquo%3bve%20always%20felt%20a%20bit%20hesitant%20to%20try%20out%20new%20tools%20for%20managing%20my%20python%20development%20environments.%20I%20had%20been%20safe%20and%20happy%20in%20the%20antiquated%20but%20efficient%20pip%20%2b%20virtualenv%20%2b%20pyenv%20world%2c%20and%20had%20been%20burned%20before%20when%20I%20dared%20adventure%20beyond%20the%20path%20of%20the%20tried%20and%20true%20of%20old." aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&t=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#tldr>tl;dr</a></li><li><a href=#install-multiple-python-versions>Install multiple python versions</a></li><li><a href=#poetry-to-manage-your-python-environment>Poetry to manage your python environment</a></li><li><a href=#bonus-automatically-activate-poetry-environment-with-direnv>Bonus: automatically activate poetry environment with direnv</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Managing multiple python versions with Homebrew and Poetry</h1><div class=meta><div class=postdate><time datetime="2022-11-14 14:56:06 +0000 UTC" itemprop=datePublished>2022-11-14</time></div></div></header><div class=content itemprop=articleBody><h2 id=tldr>tl;dr</h2><ul><li><code>brew install python@&lt;pythonversion></code> to install multiple python versions</li><li><code>poetry env use &lt;pythonversion></code> to create virtual environment</li><li>direnv to automatically switch on entering directory</li></ul><hr><p>I&rsquo;ve always felt a bit hesitant to try out new tools for managing my python development environments. I had been safe and happy in the antiquated but efficient pip + virtualenv + pyenv world, and had been <a href=https://pipenv.pypa.io/en/latest/>burned before</a> when I dared adventure beyond the path of the tried and true of old. Yes, I didn&rsquo;t have fancy colorized terminal output, but it worked.</p><p>But then I got myself a Mac M1, and that put some brakes in my workflow, slowing it down just enough to justify spending the effort to update my ways. So I found that <a href=https://python-poetry.org/>Poetry</a>, together with <a href=https://brew.sh/>Homebrew</a>, is a decent solution to the problem of managing multiple environments of a project, and makes it trivial to support different python versions at the same time.</p><h2 id=install-multiple-python-versions>Install multiple python versions</h2><p>Simply using homebrew, you can have multiple working python versions in your system at once:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ brew install python@3.9
</span></span><span style=display:flex><span>$ brew install python@3.11
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>(version 3.7 and below are not supported in the M1 Mac however)</p><p>Each version will install symlinks in <code>/opt/homebrew/bin</code> (default path for Mac M1, might be different in other systems) and you can refer directly to the binary of the individual minor version numbers, e.g. <code>python3.9</code> or <code>python3.11</code>.</p><p>This setup is super simple and easy to use, but unlike with <a href=https://github.com/pyenv/pyenv>pyenv</a>, you can only specify major+minor version, and not the patch number (e.g., 3.10, not 3.10.5). You&rsquo;ll just get the latest patch version for each major+minor that&rsquo;s been built for homebrew. For similar reasons, you can&rsquo;t install development versions (betas, pre-releases etc).</p><h2 id=poetry-to-manage-your-python-environment>Poetry to manage your python environment</h2><p>Assuming you have a recent version of poetry installed globally already (shouldn&rsquo;t matter in which version of python you installed it), you can just define the version of python you want when you first initialize the environment.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ cd my-project
</span></span><span style=display:flex><span>$ poetry init -n --python<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;*&#34;</span> <span style=color:#75715e># in case there is no pyproject.toml already, it creates one with loose py version</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ poetry env use 3.10 <span style=color:#75715e># looks for python3.10 in the PATH, and create a virtual env from that</span>
</span></span><span style=display:flex><span>Creating virtualenv my-project-QXbwbAtx-py3.10 in &lt;REDACTED&gt;/pypoetry/virtualenvs
</span></span><span style=display:flex><span>Using virtualenv: &lt;REDACTED&gt;/pypoetry/virtualenvs/my-project-QXbwbAtx-py3.10
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ poetry install 
</span></span></code></pre></div><p>If you want to switch to a different python environment just use the <code>poetry env use</code> command again. You maybe have to reinstall the packages in the new environment, and likely redo the lock file because the compatible versions of your dependencies may change.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ poetry env use 3.11
</span></span><span style=display:flex><span>Creating virtualenv my-project-QXbwbAtx-py3.11 in &lt;REDACTED&gt;/pypoetry/virtualenvs
</span></span><span style=display:flex><span>Using virtualenv: &lt;REDACTED&gt;/pypoetry/virtualenvs/my-project-QXbwbAtx-py3.11
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ poetry install
</span></span></code></pre></div><p>To execute a python script in the latest environment you selected, you can do <code>poetry run python &lt;script></code>. Alternatively, run <code>poetry shell</code> to start a new shell session in this environment.</p><h2 id=bonus-automatically-activate-poetry-environment-with-direnv>Bonus: automatically activate poetry environment with direnv</h2><p>If you know <a href=https://direnv.net/>direnv</a>, you know where this is going. If not, you&rsquo;re in for a treat! direnv is a neat little shell tool that allows you to set environment variables or execute commands upon changing into any directory. You can also use it to automatically activate the poetry environment so you don&rsquo;t need to keep typing <code>poetry run/shell</code></p><p>First you need to add a poetry hook for direnv. Edit your <code>$HOME/.direnvrc</code> and add this</p><pre tabindex=0><code>layout_poetry() {
  if [[ ! -f pyproject.toml ]]; then
    log_error &#39;No pyproject.toml found. Use `poetry new` or `poetry init` to create one first.&#39;
    exit 2
  fi

  # create venv if it doesn&#39;t exist
  poetry run true

  export VIRTUAL_ENV=$(poetry env info --path)
  export POETRY_ACTIVE=1
  PATH_add &#34;$VIRTUAL_ENV/bin&#34;
}
</code></pre><p>Now you can use the <code>layout poetry</code> command in direnv, like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ cd my-project
</span></span><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;layout poetry&#39;</span> &gt;&gt; .envrc
</span></span><span style=display:flex><span>$ direnv allow 
</span></span></code></pre></div><p>Now every time you enter your project&rsquo;s directory, poetry will automatically activate the environment:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ cd my-project
</span></span><span style=display:flex><span>direnv: loading /private/tmp/my-project/.envrc
</span></span><span style=display:flex><span>direnv: export +POETRY_ACTIVE +VIRTUAL_ENV ~PATH
</span></span><span style=display:flex><span>$ which python <span style=color:#75715e># no need to run poetry shell</span>
</span></span><span style=display:flex><span>&lt;REDACTED&gt;/pypoetry/virtualenvs/my-project-QXbwbAtx-py3.10/bin/python
</span></span></code></pre></div><p>(Notice that if you change your poetry env, you have to exit and re-enter the project directory for it to recognize the new python executable)</p><p>I love direnv, but unfortunately find this auto activation of poetry too slow for my tastes (a couple of seconds in my experience, which is weird), so I don&rsquo;t currently use it, and prefer to run <code>poetry run</code> manually.</p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#tldr>tl;dr</a></li><li><a href=#install-multiple-python-versions>Install multiple python versions</a></li><li><a href=#poetry-to-manage-your-python-environment>Poetry to manage your python environment</a></li><li><a href=#bonus-automatically-activate-poetry-environment-with-direnv>Bonus: automatically activate poetry environment with direnv</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&text=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&title=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&is_video=false&description=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry&body=Check out this article: %2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&title=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&title=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&name=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry&description=tl%3bdr%20brew%20install%20python%40%26lt%3bpythonversion%26gt%3b%20to%20install%20multiple%20python%20versions%20poetry%20env%20use%20%26lt%3bpythonversion%26gt%3b%20to%20create%20virtual%20environment%20direnv%20to%20automatically%20switch%20on%20entering%20directory%20I%26rsquo%3bve%20always%20felt%20a%20bit%20hesitant%20to%20try%20out%20new%20tools%20for%20managing%20my%20python%20development%20environments.%20I%20had%20been%20safe%20and%20happy%20in%20the%20antiquated%20but%20efficient%20pip%20%2b%20virtualenv%20%2b%20pyenv%20world%2c%20and%20had%20been%20burned%20before%20when%20I%20dared%20adventure%20beyond%20the%20path%20of%20the%20tried%20and%20true%20of%20old." aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=%2f%2fwww.jgsousa.com%2fposts%2fhomebrew-poetry-python-versions%2f&t=Managing%20multiple%20python%20versions%20with%20Homebrew%20and%20Poetry" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2023 João G. Sousa</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script></html>